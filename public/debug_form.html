<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Registration Form - B-Cash</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .debug-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .debug-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>Debug Registration Form</h1>
        <p>This page tests the registration form data collection step by step.</p>
        
        <form id="debugForm">
            <div class="form-group">
                <label class="form-label">Full Name:</label>
                <input type="text" name="full_name" class="form-input" value="Test User Debug" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Phone Number:</label>
                <input type="tel" name="phone_number" class="form-input" value="09888888888" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Email:</label>
                <input type="email" name="email" class="form-input" value="debug@example.com" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Password:</label>
                <input type="password" name="password" class="form-input" value="password123" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Birthdate:</label>
                <input type="date" name="birthdate" class="form-input" value="1990-01-01" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Address:</label>
                <input type="text" name="address" class="form-input" value="123 Test Street" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Gender:</label>
                <select class="form-input" name="gender" required>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <button type="submit" class="form-button">Test Form Data Collection</button>
        </form>
        
        <div id="result"></div>
        
        <div class="debug-info">
            <h3>Debug Information:</h3>
            <div id="debugInfo"></div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
        // Test the form data collection
        document.getElementById('debugForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const debugInfo = document.getElementById('debugInfo');
            const result = document.getElementById('result');
            
            debugInfo.innerHTML = '';
            result.innerHTML = '<div class="info">Testing form data collection...</div>';
            
            try {
                // Step 1: Check if authService is available
                debugInfo.innerHTML += '1. Checking authService... ';
                if (typeof window.authService !== 'undefined') {
                    debugInfo.innerHTML += '✓ Available\n';
                } else {
                    debugInfo.innerHTML += '✗ Not available\n';
                    throw new Error('authService not available');
                }
                
                // Step 2: Collect form data
                debugInfo.innerHTML += '2. Collecting form data... ';
                const formData = new FormData(this);
                const userData = {
                    full_name: formData.get('full_name'),
                    phone_number: formData.get('phone_number'),
                    email: formData.get('email'),
                    password: formData.get('password'),
                    birthdate: formData.get('birthdate'),
                    address: formData.get('address'),
                    gender: formData.get('gender')
                };
                debugInfo.innerHTML += '✓ Collected\n';
                debugInfo.innerHTML += '   Data: ' + JSON.stringify(userData, null, 2) + '\n';
                
                // Step 3: Validate required fields
                debugInfo.innerHTML += '3. Validating required fields... ';
                const requiredFields = ['full_name', 'phone_number', 'email', 'password', 'birthdate', 'address', 'gender'];
                const missingFields = requiredFields.filter(field => !userData[field]);
                
                if (missingFields.length === 0) {
                    debugInfo.innerHTML += '✓ All required fields present\n';
                } else {
                    debugInfo.innerHTML += '✗ Missing fields: ' + missingFields.join(', ') + '\n';
                    throw new Error('Missing required fields');
                }
                
                // Step 4: Call registration API
                debugInfo.innerHTML += '4. Calling registration API... ';
                const registerResult = await window.authService.register(userData);
                debugInfo.innerHTML += '✓ Called\n';
                debugInfo.innerHTML += '   Result: ' + JSON.stringify(registerResult, null, 2) + '\n';
                
                // Step 5: Check result
                if (registerResult.success) {
                    result.innerHTML = '<div class="success">✓ Registration successful! User ID: ' + registerResult.data.user_id + '</div>';
                } else {
                    result.innerHTML = '<div class="error">✗ Registration failed: ' + registerResult.message + '</div>';
                }
                
            } catch (error) {
                debugInfo.innerHTML += '✗ Error: ' + error.message + '\n';
                result.innerHTML = '<div class="error">✗ Test failed: ' + error.message + '</div>';
                console.error('Test error:', error);
            }
        });
        
        // Show initial debug info
        document.getElementById('debugInfo').innerHTML = 
            'Page loaded. authService available: ' + (typeof window.authService !== 'undefined') + '\n';
    </script>
</body>
</html> 