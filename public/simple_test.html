<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Registration Test - B-Cash</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .test-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .debug-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Simple Registration Test</h1>
        <p>This page tests the registration flow step by step.</p>
        
        <form id="testForm">
            <div class="form-group">
                <label class="form-label">Full Name:</label>
                <input type="text" name="full_name" class="form-input" value="Test User 999" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Phone Number:</label>
                <input type="tel" name="phone_number" class="form-input" value="09888888888" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Email:</label>
                <input type="email" name="email" class="form-input" value="test888@example.com" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Password:</label>
                <input type="password" name="password" class="form-input" value="password123" required>
            </div>
            
            <button type="submit" class="form-button">Test Registration</button>
        </form>
        
        <div id="result"></div>
        
        <div class="debug-info">
            <h3>Debug Information:</h3>
            <div id="debugInfo"></div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
        // Test the registration flow
        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const debugInfo = document.getElementById('debugInfo');
            const result = document.getElementById('result');
            
            debugInfo.innerHTML = '';
            result.innerHTML = '<div class="info">Testing registration...</div>';
            
            try {
                // Step 1: Check if authService is available
                debugInfo.innerHTML += '<div>1. Checking authService... ';
                if (typeof window.authService !== 'undefined') {
                    debugInfo.innerHTML += '<span class="success">✓ Available</span></div>';
                } else {
                    debugInfo.innerHTML += '<span class="error">✗ Not available</span></div>';
                    throw new Error('authService not available');
                }
                
                // Step 2: Collect form data
                debugInfo.innerHTML += '<div>2. Collecting form data... ';
                const formData = new FormData(this);
                const userData = {
                    full_name: formData.get('full_name'),
                    phone_number: formData.get('phone_number'),
                    email: formData.get('email'),
                    password: formData.get('password')
                };
                debugInfo.innerHTML += '<span class="success">✓ Collected</span></div>';
                debugInfo.innerHTML += '<div>&nbsp;&nbsp;Data: ' + JSON.stringify(userData) + '</div>';
                
                // Step 3: Call registration API
                debugInfo.innerHTML += '<div>3. Calling registration API... ';
                const registerResult = await window.authService.register(userData);
                debugInfo.innerHTML += '<span class="success">✓ Called</span></div>';
                debugInfo.innerHTML += '<div>&nbsp;&nbsp;Result: ' + JSON.stringify(registerResult) + '</div>';
                
                // Step 4: Check result
                if (registerResult.success) {
                    result.innerHTML = '<div class="success">✓ Registration successful! User ID: ' + registerResult.data.user_id + '</div>';
                } else {
                    result.innerHTML = '<div class="error">✗ Registration failed: ' + registerResult.message + '</div>';
                }
                
            } catch (error) {
                debugInfo.innerHTML += '<div class="error">✗ Error: ' + error.message + '</div>';
                result.innerHTML = '<div class="error">✗ Test failed: ' + error.message + '</div>';
                console.error('Test error:', error);
            }
        });
        
        // Show initial debug info
        document.getElementById('debugInfo').innerHTML = 
            '<div>Page loaded. authService available: ' + (typeof window.authService !== 'undefined') + '</div>';
    </script>
</body>
</html> 